<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="This is the blog of Dmitry Rusanov, a lawyer and programmer. I am writing articles about what interests me."/><title>Rusanov | BLOG</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/26ee18714e8c1b8133c0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/26ee18714e8c1b8133c0.css"/><link rel="preload" href="/_next/static/css/02d823be04129ddc5ec2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/02d823be04129ddc5ec2.css"/><link rel="preload" href="/_next/static/86lZNDNILU_pQpWqhTWDt/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/86lZNDNILU_pQpWqhTWDt/pages/authors.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.619a4f70c1d4d3a29cbc.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ba00499b6a441586f8e1.js" as="script"/><link rel="preload" href="/_next/static/chunks/ff464e4562f6c31279d9bd8c0bed79519698c9d3.4c7da394e979e6728873.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-5efe7097b50dd488e733.js" as="script"/><link rel="preload" href="/_next/static/chunks/1bfc9850.b3aa28fb62092b026613.js" as="script"/><link rel="preload" href="/_next/static/chunks/0e8adca713732b351af2d2715c55a1c9b08d535f.ae437141081e3eebb90c.js" as="script"/></head><body><div id="__next"><header><nav class="Nav_nav__2QeeE"><div class="Nav_container__2Iy4D"><div class="Logo_logo__14Tkn">Rusanov<b> | BLOG</b></div><ul class="Nav_menu__2OfDq"><li><a href="/">Посты</a></li><li><a href="/about-me">Обо мне</a></li></ul></div></nav></header><main><div class="Author_posts__d603K"><div class="PostPreview_wrapperSmall__2b4qN"><article class="PostPreview_post__iQOgI"><div class="PostPreview_header__HO4Hj" style="background-image:url(&quot;http://d-rusanov.ru/media/thread_python.png&quot;)"></div><div class="PostPreview_content__hEas5"><h2><a href="/post/1">Python | Комбинирование асинхронного кода с потоками и процессами</a></h2><p>Асинхронность в Python набирает популярность многие библиотеки переписываются на асинхронный код. Но даже синхронный код можно запускать таким способом, чтобы вся программа не останавливалась, а продолжала работать.
Для этого в Python есть `executor` из `concurrent.futures`. Это может быть как `ThreadPoolExecutor` для запуска в отдельном потоке, так и `ProcessPoolExecutor` для запуска в отдельном процессе.

&amp;nbsp;
### Запуск в отдельном потоке

У цикла событий есть метод `run_in_executor()` которй принимает экземпляр `concurrent.futures.Executor`. Он принимает `executor`, функцию для запуска и её параметры.
```python
import asyncio
import concurrent.futures
import logging
import sys
import time


def blocks(n):
    log = logging.getLogger(&#x27;blocks({})&#x27;.format(n))
    log.info(&#x27;running&#x27;)
    time.sleep(0.1)
    log.info(&#x27;done&#x27;)
    return n ** 2


async def run_blocking_tasks(executor):
    log = logging.getLogger(&#x27;run_blocking_tasks&#x27;)
    log.info(&#x27;starting&#x27;)

    log.info(&#x27;creating executor tasks&#x27;)
    loop = asyncio.get_event_loop()
    blocking_tasks = [
        loop.run_in_executor(executor, blocks, i)
        for i in range(6)
    ]
    log.info(&#x27;waiting for executor tasks&#x27;)
    completed, pending = await asyncio.wait(blocking_tasks)
    results = [t.result() for t in completed]
    log.info(&#x27;results: {!r}&#x27;.format(results))

    log.info(&#x27;exiting&#x27;)


if __name__ == &#x27;__main__&#x27;:
    # Configure logging to show the name of the thread
    # where the log message originates.
    logging.basicConfig(
        level=logging.INFO,
        format=&#x27;%(threadName)10s %(name)18s: %(message)s&#x27;,
        stream=sys.stderr,
    )

    # Create a limited thread pool.
    executor = concurrent.futures.ThreadPoolExecutor(
        max_workers=3,
    )

    event_loop = asyncio.get_event_loop()
    try:
        event_loop.run_until_complete(
            run_blocking_tasks(executor)
        )
    finally:
        event_loop.close()
```
&amp;nbsp;
#### Вывод:
&amp;nbsp;


```bash
MainThread run_blocking_tasks: Старт
MainThread run_blocking_tasks: Создаем задачи
ThreadPoolExecutor-0_0      block_task(0): Запущен
ThreadPoolExecutor-0_1      block_task(1): Запущен
ThreadPoolExecutor-0_2      block_task(2): Запущен
MainThread run_blocking_tasks: Ожидание выполнения задач
ThreadPoolExecutor-0_0      block_task(0): Сделано
ThreadPoolExecutor-0_1      block_task(1): Сделано
ThreadPoolExecutor-0_0      block_task(3): Запущен
ThreadPoolExecutor-0_1      block_task(4): Запущен
ThreadPoolExecutor-0_2      block_task(2): Сделано
ThreadPoolExecutor-0_2      block_task(5): Запущен
ThreadPoolExecutor-0_1      block_task(4): Сделано
ThreadPoolExecutor-0_1      block_task(6): Запущен
ThreadPoolExecutor-0_0      block_task(3): Сделано
ThreadPoolExecutor-0_0      block_task(7): Запущен
ThreadPoolExecutor-0_2      block_task(5): Сделано
ThreadPoolExecutor-0_2      block_task(8): Запущен
ThreadPoolExecutor-0_1      block_task(6): Сделано
ThreadPoolExecutor-0_1      block_task(9): Запущен
ThreadPoolExecutor-0_0      block_task(7): Сделано
ThreadPoolExecutor-0_2      block_task(8): Сделано
ThreadPoolExecutor-0_1      block_task(9): Сделано
MainThread run_blocking_tasks: Результат: [25, 4, 36, 81, 9, 49, 0, 16, 64, 1]
MainThread run_blocking_tasks: Конец
dima@dima-rus:~/Desktop/learning/asyncio_learn/samples$ clear
dima@dima-rus:~/Desktop/learning/asyncio_learn/samples$ python3 thread_executor.py 
MainThread run_blocking_tasks: Старт
MainThread run_blocking_tasks: Создаем задачи
ThreadPoolExecutor-0_0      block_task(0): Запущен
ThreadPoolExecutor-0_1      block_task(1): Запущен
ThreadPoolExecutor-0_2      block_task(2): Запущен
MainThread run_blocking_tasks: Ожидание выполнения задач
ThreadPoolExecutor-0_0      block_task(0): Сделано
ThreadPoolExecutor-0_0      block_task(3): Запущен
ThreadPoolExecutor-0_1      block_task(1): Сделано
ThreadPoolExecutor-0_1      block_task(4): Запущен
ThreadPoolExecutor-0_2      block_task(2): Сделано
ThreadPoolExecutor-0_2      block_task(5): Запущен
ThreadPoolExecutor-0_0      block_task(3): Сделано
ThreadPoolExecutor-0_0      block_task(6): Запущен
ThreadPoolExecutor-0_1      block_task(4): Сделано
ThreadPoolExecutor-0_1      block_task(7): Запущен
ThreadPoolExecutor-0_2      block_task(5): Сделано
ThreadPoolExecutor-0_2      block_task(8): Запущен
ThreadPoolExecutor-0_0      block_task(6): Сделано
ThreadPoolExecutor-0_0      block_task(9): Запущен
ThreadPoolExecutor-0_1      block_task(7): Сделано
ThreadPoolExecutor-0_2      block_task(8): Сделано
ThreadPoolExecutor-0_0      block_task(9): Сделано
MainThread run_blocking_tasks: Результат: [25, 4, 36, 81, 9, 49, 0, 16, 64, 1]
MainThread run_blocking_tasks: Конец

```
&amp;nbsp;
### Запуск в отдельном процессе

Здесь `ThreadPoolExecutor` заменяется на `ProcessPoolExecutor`. И происходит запуск нескольких процессов на кождом ядре т.е. работает несколько интерпретаторов Python. В этом случае блокирующие задачи действительно выполняются параллельно, в отличие от потоков где они переключаются на уровне операционной системы. Это вызвано ограничением `GIL`.

Теперь вы можете эффективно использовать блокирующий код в асинхронном приложении.</p><div>Last edit: <!-- -->Tue Dec 22 2020</div></div></article></div></div><div class="Author_posts__d603K"><div class="PostPreview_wrapperSmall__2b4qN"><article class="PostPreview_post__iQOgI"><div class="PostPreview_header__HO4Hj" style="background-image:url(&quot;http://d-rusanov.ru/media/carbon4.png&quot;)"></div><div class="PostPreview_content__hEas5"><h2><a href="/post/2">test</a></h2><p>test</p><div>Last edit: <!-- -->Mon Dec 21 2020</div></div></article></div></div></main><footer class="Footer_footer__tzq27"><div class="Footer_wrapper__359bV"><div class="Footer_info__3XLIw"><div class="Logo_logo__14Tkn">Rusanov<b> | BLOG</b></div><p class="Footer_description__3KK6N">This is the blog of Dmitry Rusanov, a lawyer and programmer. I am writing articles about what interests me.</p><div class="SocialIcons_social__2H3Dt"><a href="https://www.youtube.com/channel/UCjl1oFkCqlAXjqqSD_1oVGw?view_as=subscriber" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a><a target="_blank" rel="noreferrer" hidden=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a><a target="_blank" rel="noreferrer" hidden=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"></path></svg></a><a target="_blank" rel="noreferrer" hidden=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg></a><a target="_blank" rel="noreferrer" hidden=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg></a><a target="_blank" rel="noreferrer" hidden=""><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://github.com/Random1k11" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://stackoverflow.com/users/12097204/random1k11?tab=profile" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"></path></svg></a></div></div><div class="Footer_contacts__149C3"><b>Contacts</b><br/><a href="https://t.me/Qazart" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"></path></svg></a><a href="https://wa.me/79774083327" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"></path></svg></a>+79774083327<br/><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg> random1k11@gmail.com</div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"id":1,"title":"Python | Комбинирование асинхронного кода с потоками и процессами","text":"Асинхронность в Python набирает популярность многие библиотеки переписываются на асинхронный код. Но даже синхронный код можно запускать таким способом, чтобы вся программа не останавливалась, а продолжала работать.\r\nДля этого в Python есть `executor` из `concurrent.futures`. Это может быть как `ThreadPoolExecutor` для запуска в отдельном потоке, так и `ProcessPoolExecutor` для запуска в отдельном процессе.\r\n\r\n\u0026nbsp;\r\n### Запуск в отдельном потоке\r\n\r\nУ цикла событий есть метод `run_in_executor()` которй принимает экземпляр `concurrent.futures.Executor`. Он принимает `executor`, функцию для запуска и её параметры.\r\n```python\r\nimport asyncio\r\nimport concurrent.futures\r\nimport logging\r\nimport sys\r\nimport time\r\n\r\n\r\ndef blocks(n):\r\n    log = logging.getLogger('blocks({})'.format(n))\r\n    log.info('running')\r\n    time.sleep(0.1)\r\n    log.info('done')\r\n    return n ** 2\r\n\r\n\r\nasync def run_blocking_tasks(executor):\r\n    log = logging.getLogger('run_blocking_tasks')\r\n    log.info('starting')\r\n\r\n    log.info('creating executor tasks')\r\n    loop = asyncio.get_event_loop()\r\n    blocking_tasks = [\r\n        loop.run_in_executor(executor, blocks, i)\r\n        for i in range(6)\r\n    ]\r\n    log.info('waiting for executor tasks')\r\n    completed, pending = await asyncio.wait(blocking_tasks)\r\n    results = [t.result() for t in completed]\r\n    log.info('results: {!r}'.format(results))\r\n\r\n    log.info('exiting')\r\n\r\n\r\nif __name__ == '__main__':\r\n    # Configure logging to show the name of the thread\r\n    # where the log message originates.\r\n    logging.basicConfig(\r\n        level=logging.INFO,\r\n        format='%(threadName)10s %(name)18s: %(message)s',\r\n        stream=sys.stderr,\r\n    )\r\n\r\n    # Create a limited thread pool.\r\n    executor = concurrent.futures.ThreadPoolExecutor(\r\n        max_workers=3,\r\n    )\r\n\r\n    event_loop = asyncio.get_event_loop()\r\n    try:\r\n        event_loop.run_until_complete(\r\n            run_blocking_tasks(executor)\r\n        )\r\n    finally:\r\n        event_loop.close()\r\n```\r\n\u0026nbsp;\r\n#### Вывод:\r\n\u0026nbsp;\r\n\r\n\r\n```bash\r\nMainThread run_blocking_tasks: Старт\r\nMainThread run_blocking_tasks: Создаем задачи\r\nThreadPoolExecutor-0_0      block_task(0): Запущен\r\nThreadPoolExecutor-0_1      block_task(1): Запущен\r\nThreadPoolExecutor-0_2      block_task(2): Запущен\r\nMainThread run_blocking_tasks: Ожидание выполнения задач\r\nThreadPoolExecutor-0_0      block_task(0): Сделано\r\nThreadPoolExecutor-0_1      block_task(1): Сделано\r\nThreadPoolExecutor-0_0      block_task(3): Запущен\r\nThreadPoolExecutor-0_1      block_task(4): Запущен\r\nThreadPoolExecutor-0_2      block_task(2): Сделано\r\nThreadPoolExecutor-0_2      block_task(5): Запущен\r\nThreadPoolExecutor-0_1      block_task(4): Сделано\r\nThreadPoolExecutor-0_1      block_task(6): Запущен\r\nThreadPoolExecutor-0_0      block_task(3): Сделано\r\nThreadPoolExecutor-0_0      block_task(7): Запущен\r\nThreadPoolExecutor-0_2      block_task(5): Сделано\r\nThreadPoolExecutor-0_2      block_task(8): Запущен\r\nThreadPoolExecutor-0_1      block_task(6): Сделано\r\nThreadPoolExecutor-0_1      block_task(9): Запущен\r\nThreadPoolExecutor-0_0      block_task(7): Сделано\r\nThreadPoolExecutor-0_2      block_task(8): Сделано\r\nThreadPoolExecutor-0_1      block_task(9): Сделано\r\nMainThread run_blocking_tasks: Результат: [25, 4, 36, 81, 9, 49, 0, 16, 64, 1]\r\nMainThread run_blocking_tasks: Конец\r\ndima@dima-rus:~/Desktop/learning/asyncio_learn/samples$ clear\r\ndima@dima-rus:~/Desktop/learning/asyncio_learn/samples$ python3 thread_executor.py \r\nMainThread run_blocking_tasks: Старт\r\nMainThread run_blocking_tasks: Создаем задачи\r\nThreadPoolExecutor-0_0      block_task(0): Запущен\r\nThreadPoolExecutor-0_1      block_task(1): Запущен\r\nThreadPoolExecutor-0_2      block_task(2): Запущен\r\nMainThread run_blocking_tasks: Ожидание выполнения задач\r\nThreadPoolExecutor-0_0      block_task(0): Сделано\r\nThreadPoolExecutor-0_0      block_task(3): Запущен\r\nThreadPoolExecutor-0_1      block_task(1): Сделано\r\nThreadPoolExecutor-0_1      block_task(4): Запущен\r\nThreadPoolExecutor-0_2      block_task(2): Сделано\r\nThreadPoolExecutor-0_2      block_task(5): Запущен\r\nThreadPoolExecutor-0_0      block_task(3): Сделано\r\nThreadPoolExecutor-0_0      block_task(6): Запущен\r\nThreadPoolExecutor-0_1      block_task(4): Сделано\r\nThreadPoolExecutor-0_1      block_task(7): Запущен\r\nThreadPoolExecutor-0_2      block_task(5): Сделано\r\nThreadPoolExecutor-0_2      block_task(8): Запущен\r\nThreadPoolExecutor-0_0      block_task(6): Сделано\r\nThreadPoolExecutor-0_0      block_task(9): Запущен\r\nThreadPoolExecutor-0_1      block_task(7): Сделано\r\nThreadPoolExecutor-0_2      block_task(8): Сделано\r\nThreadPoolExecutor-0_0      block_task(9): Сделано\r\nMainThread run_blocking_tasks: Результат: [25, 4, 36, 81, 9, 49, 0, 16, 64, 1]\r\nMainThread run_blocking_tasks: Конец\r\n\r\n```\r\n\u0026nbsp;\r\n### Запуск в отдельном процессе\r\n\r\nЗдесь `ThreadPoolExecutor` заменяется на `ProcessPoolExecutor`. И происходит запуск нескольких процессов на кождом ядре т.е. работает несколько интерпретаторов Python. В этом случае блокирующие задачи действительно выполняются параллельно, в отличие от потоков где они переключаются на уровне операционной системы. Это вызвано ограничением `GIL`.\r\n\r\nТеперь вы можете эффективно использовать блокирующий код в асинхронном приложении.","image":"http://d-rusanov.ru/media/thread_python.png","active":true,"updated_at":"2020-12-22T13:51:20.042933+03:00","created_at":"2020-12-18T00:09:20.919858+03:00","categories":[]},{"id":2,"title":"test","text":"test","image":"http://d-rusanov.ru/media/carbon4.png","active":true,"updated_at":"2020-12-21T21:59:24.637560+03:00","created_at":"2020-12-21T21:59:24.644192+03:00","categories":[]}]},"__N_SSG":true},"page":"/authors","query":{},"buildId":"86lZNDNILU_pQpWqhTWDt","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-2176b8fd390f794ddf9e.js"></script><script async="" data-next-page="/_app" src="/_next/static/86lZNDNILU_pQpWqhTWDt/pages/_app.js"></script><script async="" data-next-page="/authors" src="/_next/static/86lZNDNILU_pQpWqhTWDt/pages/authors.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.619a4f70c1d4d3a29cbc.js" async=""></script><script src="/_next/static/chunks/commons.ba00499b6a441586f8e1.js" async=""></script><script src="/_next/static/chunks/ff464e4562f6c31279d9bd8c0bed79519698c9d3.4c7da394e979e6728873.js" async=""></script><script src="/_next/static/runtime/main-5efe7097b50dd488e733.js" async=""></script><script src="/_next/static/chunks/1bfc9850.b3aa28fb62092b026613.js" async=""></script><script src="/_next/static/chunks/0e8adca713732b351af2d2715c55a1c9b08d535f.ae437141081e3eebb90c.js" async=""></script><script src="/_next/static/86lZNDNILU_pQpWqhTWDt/_buildManifest.js" async=""></script><script src="/_next/static/86lZNDNILU_pQpWqhTWDt/_ssgManifest.js" async=""></script></body></html>